# rsync ë° ssh í•™ìŠµ

## rsync ê¸°ë³¸ ê°œë… ë° ë¡œì»¬ ë™ê¸°í™”

### rsyncë€?
- íŒŒì¼ ë° ë””ë ‰í† ë¦¬ ë™ê¸°í™” ë„êµ¬
- ë³€ê²½ëœ íŒŒì¼ë§Œ ì „ì†¡
- ë°±ì—…, ë°°í¬, ì„œë²„ ê°„ ë™ê¸°í™”ì— ì‚¬ìš©

### ê¸°ë³¸ rsync ì‹¤ìŠµ
```bash
# -a : archive(ê¶Œí•œ, ì†Œìœ ì, ì‹œê°„ ìœ ì§€)
# -v : verbose(ì¶œë ¥ í‘œì‹œ)

rsync -av /var/www/site1/ ~/backup/site1/
```

## rsync + SSH (Remote Sync)

### rsync + ssh ì‹¤ìŠµ
```bash
rsync -av -e ssh /var/www/site1/ leesyungg@localhost:/home/leesyungg/backup/site1-remote/
```

ìœ— ëª…ë ¹ì–´ëŠ” `/var/www/site1`ì˜ ë‚´ìš©ì„ SSHì„ í†µí•´ ì›ê²© ì„œë²„ë¡œ ë™ê¸°í™”í•˜ë¼ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤(ë‹¤ë§Œ ì—°ìŠµì—ì„œëŠ” localhostë¡œ ì›ê²© ì„œë²„ë¥¼ ê°€ì •í•˜ê³  ì§„í–‰í–ˆìŠµë‹ˆë‹¤).

í•˜ì§€ë§Œ Azure Virtual Machineì—ì„œ SSH ì ‘ì† ë°©ì‹ë§Œ í—ˆìš©í–ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì¸ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤. ì•„ë˜ SSH Key ì¸ì¦ ë‚´ìš©ì„ ìˆ˜í–‰í•´ ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.

## SSH Key ì¸ì¦

### SSH Key êµ¬ì„± ìš”ì†Œ

> ğŸ¥• íŒŒì¼ ì´ë¦„ì€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

| ì—­í•  | íŒŒì¼ |
| ---  | ---  |
| ê°œì¸í‚¤ | ~/.ssh/id_ed25519 |
| ê³µê°œí‚¤ | ~/.ssh/id_ed25519.pub |
| í—ˆìš© ëª©ë¡ | ~/.ssh/authorized_keys |

### ìƒì„± -> ë“±ë¡ -> í…ŒìŠ¤íŠ¸ ì‹¤ìŠµ
ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ ì„œë²„ìš© ssh keyë¥¼ ìƒì„±í•©ë‹ˆë‹¤ :
```bash
# ìƒì„±ì‹œ ì…ë ¥í•˜ë¼ê³  ë‚˜ì˜¤ëŠ” passphraseëŠ” ì—”í„°ë¡œ ìƒëµí•©ë‹ˆë‹¤(ì—°ìŠµì´ë¯€ë¡œ)

ssh-keygen -t ed25519 -f ~/.ssh/id_ed25519
```

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ ê³µê°œí‚¤ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤ :
```bash
cat ~/.ssh/id_ed25519.pub >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ ssh ì ‘ì†ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤ :
```bash
ssh leesyungg@localhost
```

ê·¸ëŸ¼ ì´ì œ ë‹¤ì‹œ `rsync+ssh` ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•´ë´…ë‹ˆë‹¤ :
```bash
rsync -av -e ssh /var/www/site1/ leesyungg@localhost:/home/leesyungg/backup/site1-remote/
```

ì´ì œ `Permission denied(publickey)` ë¬¸ì œëŠ” í•´ê²°í–ˆìœ¼ë©°, ì„œë²„ ê°„ ë™ê¸°í™” ê¸°ëŠ¥(ë¬¼ë¡  ì—¬ê¸°ì„œëŠ” localhostë¥¼ ì›ê²© ì„œë²„ë¡œ ê°€ì •í–ˆì§€ë§Œ)ì„ ì‚¬ìš©í•´ë´¤ìŠµë‹ˆë‹¤.
